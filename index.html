<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>NAS | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© V8.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0b1120; color: #e2e8f0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .tab-btn { transition: 0.3s; border-bottom: 3px solid transparent; opacity: 0.6; }
        .tab-btn.active { opacity: 1; border-color: #3b82f6; color: #3b82f6; }
        .stat-box { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #334155; }
        .input-field { background: #1e293b; border: 1px solid #334155; color: white; border-radius: 12px; padding: 12px; }
        .btn-action { transition: transform 0.1s; }
        .btn-action:active { transform: scale(0.95); }
    </style>
</head>
<body class="pb-20">

    <nav class="flex bg-slate-900 border-b border-slate-800 sticky top-0 z-50 shadow-2xl">
        <button onclick="showSection('home')" id="btn-home" class="tab-btn active flex-1 p-4 font-bold text-xs">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button onclick="showSection('add')" id="btn-add" class="tab-btn flex-1 p-4 font-bold text-xs">â• Ø¥Ø¶Ø§ÙØ©</button>
        <button onclick="showSection('list')" id="btn-list" class="tab-btn flex-1 p-4 font-bold text-xs">ğŸ” Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</button>
    </nav>

    <div class="p-4 max-w-2xl mx-auto">
        
        <div id="sec-home" class="space-y-6">
            <h2 class="text-xl font-black text-blue-400">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡</h2>
            <div class="grid grid-cols-3 gap-2">
                <div class="stat-box p-3 rounded-2xl text-center">
                    <p class="text-[9px] text-slate-400 mb-1">Ø§Ù„ÙŠÙˆÙ…</p>
                    <p id="stat-day" class="text-sm font-black text-green-400">0</p>
                </div>
                <div class="stat-box p-3 rounded-2xl text-center">
                    <p class="text-[9px] text-slate-400 mb-1">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                    <p id="stat-week" class="text-sm font-black text-blue-400">0</p>
                </div>
                <div class="stat-box p-3 rounded-2xl text-center">
                    <p class="text-[9px] text-slate-400 mb-1">Ø§Ù„Ø´Ù‡Ø±</p>
                    <p id="stat-month" class="text-sm font-black text-purple-400">0</p>
                </div>
            </div>

            <div class="glass p-4 rounded-3xl">
                <h3 class="text-sm font-bold mb-4 flex items-center gap-2">
                    ğŸ”” ØªØ°ÙƒÙŠØ±Ø§Øª ØªÙ†ØªÙ‡ÙŠ Ø¨Ø§Ú†Ø± 
                    <span id="remind-count" class="bg-red-500 text-[10px] px-2 rounded-full">0</span>
                </h3>
                <div id="reminder-list" class="space-y-3">
                    </div>
            </div>
        </div>

        <div id="sec-add" class="hidden space-y-4">
            <div class="glass p-6 rounded-[2.5rem] space-y-4 shadow-2xl">
                <input id="name" class="input-field w-full" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
                <div class="grid grid-cols-2 gap-2">
                    <input id="price" type="number" class="input-field" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                    <input id="phone" type="tel" class="input-field" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <select id="service-select" class="input-field">
                        <option value="Canva Pro">Canva Pro</option>
                        <option value="ChatGPT">ChatGPT</option>
                        <option value="CapCut">CapCut</option>
                        <option value="CUSTOM">Ø®Ø¯Ù…Ø© Ø£Ø®Ø±Ù‰</option>
                    </select>
                    <input id="insta" class="input-field" placeholder="ÙŠÙˆØ²Ø± Ø§Ù†Ø³ØªØ§">
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setDuration(30, 'Ø´Ù‡Ø±ÙŠ')" class="bg-slate-800 p-2 rounded-xl text-xs">Ø´Ù‡Ø±</button>
                    <button onclick="setDuration(365, 'Ø³Ù†ÙˆÙŠ')" class="bg-slate-800 p-2 rounded-xl text-xs">Ø³Ù†Ø©</button>
                    <input type="date" id="expDate" class="input-field p-1 text-[10px]">
                </div>
                <div class="flex gap-2">
                    <button onclick="setPaidState(true)" id="p-true" class="flex-1 bg-green-600/20 p-3 rounded-xl border border-green-600 text-xs">Ù…Ø¯ÙÙˆØ¹</button>
                    <button onclick="setPaidState(false)" id="p-false" class="flex-1 bg-red-600/20 p-3 rounded-xl border border-red-600 text-xs">Ø¯ÙŠÙ†</button>
                </div>
                <button onclick="saveData()" id="mainBtn" class="w-full bg-blue-600 p-4 rounded-2xl font-black">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>

        <div id="sec-list" class="hidden space-y-4">
            <input id="search" oninput="renderList()" class="input-field w-full" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...">
            <div class="flex gap-2">
                <button onclick="setListFilter('Ø´Ù‡Ø±ÙŠ')" id="f-mon" class="flex-1 bg-slate-800 p-2 rounded-xl text-xs border border-slate-700">ğŸ“… Ø´Ù‡Ø±ÙŠ</button>
                <button onclick="setListFilter('Ø³Ù†ÙˆÙŠ')" id="f-year" class="flex-1 bg-slate-800 p-2 rounded-xl text-xs border border-slate-700">ğŸŒŸ Ø³Ù†ÙˆÙŠ</button>
            </div>
            <div id="main-list" class="space-y-3"></div>
        </div>
    </div>

    <div id="receiptModal" class="fixed inset-0 bg-black/95 hidden z-[60] flex items-center justify-center p-4">
        <div class="w-full max-w-xs">
            <div id="printableReceipt" class="bg-white p-6 rounded-[2.5rem] text-slate-900 shadow-2xl text-right">
                <h3 class="text-4xl font-black text-blue-600 italic text-center">NAS</h3>
                <div class="my-6 space-y-2 font-bold text-sm border-y border-slate-100 py-4">
                    <div class="flex justify-between"><span>Ø§Ù„Ø²Ø¨ÙˆÙ†:</span> <span id="rName"></span></div>
                    <div class="flex justify-between"><span>Ø§Ù„Ø®Ø¯Ù…Ø©:</span> <span id="rService"></span></div>
                    <div class="flex justify-between"><span>Ø§Ù„Ø³Ø¹Ø±:</span> <span id="rPrice"></span></div>
                    <div class="flex justify-between"><span>ÙŠÙ†ØªÙ‡ÙŠ:</span> <span id="rEnd"></span></div>
                </div>
                <p class="text-center text-[10px] font-black opacity-50">L11NL</p>
            </div>
            <button onclick="shareImage()" class="w-full bg-blue-600 mt-4 p-3 rounded-xl font-bold">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© ØµÙˆØ±Ø©</button>
            <button onclick="el('receiptModal').classList.add('hidden')" class="w-full text-slate-400 mt-2 text-xs">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const DB = "NAS_STABLE_V5_DATA";
        let clients = JSON.parse(localStorage.getItem(DB)) || [];
        let contactedToday = JSON.parse(localStorage.getItem('NAS_CONTACTED')) || [];
        let filter = 'Ø´Ù‡Ø±ÙŠ';
        let currentPaid = true;
        let currentType = 'Ø´Ù‡Ø±ÙŠ';
        let editIdx = null;

        const el = (id) => document.getElementById(id);

        function showSection(sec) {
            ['home', 'add', 'list'].forEach(s => {
                el('sec-'+s).classList.add('hidden');
                el('btn-'+s).classList.remove('active');
            });
            el('sec-'+sec).classList.remove('hidden');
            el('btn-'+sec).classList.add('active');
            if(sec === 'home') updateHome();
            if(sec === 'list') renderList();
        }

        function setDuration(days, type) {
            currentType = type;
            const d = new Date();
            d.setDate(d.getDate() + days);
            el('expDate').value = d.toISOString().split('T')[0];
        }

        function setPaidState(s) {
            currentPaid = s;
            el('p-true').style.background = s ? 'rgba(22, 163, 74, 0.4)' : '';
            el('p-false').style.background = !s ? 'rgba(220, 38, 38, 0.4)' : '';
        }

        function saveData() {
            const data = {
                name: el('name').value,
                price: Number(el('price').value),
                phone: el('phone').value,
                service: el('service-select').value,
                insta: el('insta').value,
                end: el('expDate').value,
                paid: currentPaid,
                type: currentType,
                created: new Date().toISOString()
            };
            if(!data.name || !data.end) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            if(editIdx !== null) clients[editIdx] = {...clients[editIdx], ...data};
            else clients.unshift(data);
            localStorage.setItem(DB, JSON.stringify(clients));
            location.reload();
        }

        function updateHome() {
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(now.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            let dSum = 0, wSum = 0, mSum = 0;
            clients.forEach(c => {
                const cDate = new Date(c.created || Date.now());
                if(c.paid) {
                    if(cDate.toDateString() === now.toDateString()) dSum += c.price;
                    if((now - cDate)/(1000*60*60*24) <= 7) wSum += c.price;
                    if(cDate.getMonth() === now.getMonth()) mSum += c.price;
                }
            });
            el('stat-day').innerText = dSum.toLocaleString() + " Ø¯.Ø¹";
            el('stat-week').innerText = wSum.toLocaleString() + " Ø¯.Ø¹";
            el('stat-month').innerText = mSum.toLocaleString() + " Ø¯.Ø¹";

            // ØªØ°ÙƒÙŠØ±Ø§Øª
            const reminders = clients.filter(c => c.end === tomorrowStr && !contactedToday.includes(c.name + c.end));
            el('remind-count').innerText = reminders.length;
            el('reminder-list').innerHTML = reminders.map((c, i) => `
                <div class="bg-slate-800/50 p-3 rounded-2xl flex justify-between items-center border-r-4 border-orange-500">
                    <div>
                        <p class="font-bold text-sm">${c.name}</p>
                        <p class="text-[10px] text-slate-400">${c.service} (${c.type})</p>
                    </div>
                    <button onclick="remindUser('${c.name}', '${c.phone}', '${c.end}', '${c.type}')" class="bg-orange-600 px-4 py-2 rounded-xl text-xs font-black">ØªØ°ÙƒÙŠØ± ğŸ””</button>
                </div>
            `).join('');
        }

        function remindUser(name, phone, end, type) {
            const msg = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ØŒ Ø¨Ø§Ú†Ø± ÙŠØ®Ù„Øµ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„${type} ØªØ¬Ø¯Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØŸ ğŸ˜Š`;
            window.open(`https://wa.me/964${phone}?text=${encodeURIComponent(msg)}`);
            contactedToday.push(name + end);
            localStorage.setItem('NAS_CONTACTED', JSON.stringify(contactedToday));
            updateHome();
        }

        function setListFilter(f) {
            filter = f;
            el('f-mon').style.borderColor = f === 'Ø´Ù‡Ø±ÙŠ' ? '#3b82f6' : '#334155';
            el('f-year').style.borderColor = f === 'Ø³Ù†ÙˆÙŠ' ? '#3b82f6' : '#334155';
            renderList();
        }

        function renderList() {
            const q = el('search').value.toLowerCase();
            const list = el('main-list');
            list.innerHTML = "";
            
            clients.forEach((c, i) => {
                if((c.type || 'Ø´Ù‡Ø±ÙŠ') === filter && c.name.toLowerCase().includes(q)) {
                    const isExp = c.end < new Date().toISOString().split('T')[0];
                    list.innerHTML += `
                        <div class="glass p-4 rounded-3xl border-r-4 ${isExp ? 'border-red-600' : 'border-blue-500'}">
                            <div class="flex justify-between mb-3">
                                <div>
                                    <h4 class="font-bold">${c.name}</h4>
                                    <p class="text-[10px] text-blue-400">${c.service} â€¢ ${c.price.toLocaleString()} Ø¯.Ø¹</p>
                                </div>
                                <div class="text-left">
                                    <p class="text-[9px] text-slate-400">ÙŠÙ†ØªÙ‡ÙŠ: ${c.end}</p>
                                    <button onclick="toggleType(${i})" class="text-[9px] bg-slate-700 px-2 py-1 rounded-md mt-1">ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ${c.type === 'Ø³Ù†ÙˆÙŠ' ? 'Ø´Ù‡Ø±ÙŠ' : 'Ø³Ù†ÙˆÙŠ'}</button>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="openReceipt(${i})" class="bg-white text-black text-[10px] font-bold px-3 py-1 rounded-lg">ÙˆØµÙ„</button>
                                <button onclick="editUser(${i})" class="bg-slate-700 text-[10px] px-3 py-1 rounded-lg">ØªØ¹Ø¯ÙŠÙ„</button>
                                <a href="https://instagram.com/${c.insta}" class="bg-pink-600 p-1 px-2 rounded-lg"><img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" class="w-4"></a>
                                <button onclick="deleteUser(${i})" class="text-red-500 mr-auto">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                }
            });
        }

        function toggleType(i) {
            clients[i].type = clients[i].type === 'Ø³Ù†ÙˆÙŠ' ? 'Ø´Ù‡Ø±ÙŠ' : 'Ø³Ù†ÙˆÙŠ';
            localStorage.setItem(DB, JSON.stringify(clients));
            renderList();
        }

        function openReceipt(i) {
            const c = clients[i];
            el('rName').innerText = c.name;
            el('rService').innerText = c.service;
            el('rPrice').innerText = c.price.toLocaleString() + " Ø¯.Ø¹";
            el('rEnd').innerText = c.end;
            el('receiptModal').classList.remove('hidden');
        }

        async function shareImage() {
            const canvas = await html2canvas(el('printableReceipt'), {scale: 3});
            canvas.toBlob(blob => {
                const file = new File([blob], 'receipt.png', {type:'image/png'});
                if(navigator.canShare && navigator.canShare({files:[file]})) navigator.share({files:[file]});
                else { const a=document.createElement('a'); a.download='NAS.png'; a.href=canvas.toDataURL(); a.click(); }
            });
        }

        function editUser(i) {
            editIdx = i; const c = clients[i];
            el('name').value = c.name; el('price').value = c.price; el('phone').value = c.phone;
            el('insta').value = c.insta; el('expDate').value = c.end; el('service-select').value = c.service;
            setPaidState(c.paid); currentType = c.type; showSection('add');
            el('mainBtn').innerText = "ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        }

        function deleteUser(i) { if(confirm("Ø­Ø°ÙØŸ")) { clients.splice(i,1); localStorage.setItem(DB, JSON.stringify(clients)); renderList(); } }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        updateHome();
    </script>
</body>
</html>
