<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>NAS Pro | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .input-field { background: #1e293b; border: 1px solid #334155; transition: all 0.3s; color: white; }
        .tab-btn { border-bottom: 3px solid transparent; }
        .tab-active { border-color: #3b82f6; color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .btn-active { background-color: #3b82f6 !important; color: white !important; }
        #receipt-canvas { width: 350px; padding: 20px; background: white; color: black; position: fixed; left: -9999px; }
    </style>
</head>
<body class="text-slate-200 pb-20">

    <div id="expiryAlert" class="hidden bg-red-600 text-white p-3 text-center text-sm font-bold sticky top-0 z-50 animate-pulse">
        âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ù†Ø§Ùƒ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù…Ù†ØªÙ‡ÙŠØ© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©!
    </div>

    <nav class="flex justify-around bg-slate-800 sticky top-0 z-40 border-b border-slate-700">
        <button onclick="showTab('add')" id="tabAdd" class="tab-btn flex-1 p-4 font-bold tab-active">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ</button>
        <button onclick="showTab('list')" id="tabList" class="tab-btn flex-1 p-4 font-bold">ğŸ” Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</button>
    </nav>

    <div class="p-4 max-w-2xl mx-auto">

        <div id="viewAdd" class="space-y-4">
            <h2 class="text-xl font-bold text-blue-400 mb-4">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯</h2>
            <div class="glass-card p-6 rounded-3xl space-y-4">
                <input id="name" class="input-field p-3 rounded-xl w-full" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
                
                <div class="flex gap-2">
                    <span class="bg-slate-700 p-3 rounded-xl text-slate-400 text-sm flex items-center">964+</span>
                    <input id="phone" class="input-field p-3 rounded-xl w-full" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <input id="service" class="input-field p-3 rounded-xl w-full" placeholder="Ø§Ù„Ø®Ø¯Ù…Ø© (Ù…Ø«Ù„Ø§Ù‹: ChatGPT)">
                    <input id="insta" class="input-field p-3 rounded-xl w-full" placeholder="ÙŠÙˆØ²Ø± Ø§Ù†Ø³ØªØºØ±Ø§Ù…">
                </div>

                <input id="link" class="input-field p-3 rounded-xl w-full" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø³Ø§Ø¨">
                
                <div class="space-y-2">
                    <label class="text-xs text-slate-400">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
                    <div class="grid grid-cols-3 gap-2" id="daysContainer">
                        <button class="bg-slate-800 p-2 rounded-lg text-xs border border-slate-600" onclick="setDays(this, 30)">Ø´Ù‡Ø±</button>
                        <button class="bg-slate-800 p-2 rounded-lg text-xs border border-slate-600" onclick="setDays(this, 90)">3 Ø£Ø´Ù‡Ø±</button>
                        <button class="bg-slate-800 p-2 rounded-lg text-xs border border-slate-600" onclick="setDays(this, 365)">Ø³Ù†Ø©</button>
                    </div>
                    <div class="flex flex-col gap-1 mt-2">
                        <label class="text-[10px] text-slate-400">Ø£Ùˆ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ø§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹:</label>
                        <input type="date" id="customDate" class="input-field p-2 rounded-lg w-full text-sm" onchange="setCustomDate(this.value)">
                    </div>
                </div>

                <div class="flex gap-4">
                    <button id="btnPaid" class="flex-1 bg-slate-800 p-3 rounded-xl border border-slate-600" onclick="setPaid(true)">âœ… Ù…Ø¯ÙÙˆØ¹</button>
                    <button id="btnUnpaid" class="flex-1 bg-slate-800 p-3 rounded-xl border border-slate-600" onclick="setPaid(false)">âŒ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</button>
                </div>

                <textarea id="notes" class="input-field p-3 rounded-xl w-full h-20" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>

                <button id="mainBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-2xl shadow-lg transition-all" onclick="saveClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø²Ø¨ÙˆÙ†</button>
            </div>
        </div>

        <div id="viewList" class="hidden space-y-4">
            <div class="relative">
                <input id="search" oninput="render()" class="input-field p-4 pr-12 rounded-2xl w-full" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…...">
                <span class="absolute right-4 top-4 opacity-30">ğŸ”</span>
            </div>
            
            <div id="clientsList" class="space-y-4"></div>
        </div>

    </div>

    <div id="receiptModal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white text-slate-900 p-6 rounded-3xl w-full max-w-sm text-center">
            <div id="printableReceipt" class="p-4 border-2 border-dashed border-slate-300 rounded-2xl mb-4">
                <h3 class="text-2xl font-black text-blue-600">NAS SYSTEM</h3>
                <p class="text-xs text-slate-500 mb-4">ÙˆØµÙ„ ØªØ£ÙƒÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ</p>
                <div class="text-right space-y-2 text-sm border-t pt-4">
                    <p><b>Ø§Ù„Ø²Ø¨ÙˆÙ†:</b> <span id="rName"></span></p>
                    <p><b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b> <span id="rService"></span></p>
                    <p><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</b> <span id="rEnd"></span></p>
                    <p><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> <span class="text-green-600 font-bold">ØªÙ… Ø§Ù„Ø¯ÙØ¹ âœ…</span></p>
                </div>
                <p class="mt-6 text-[10px] text-slate-400 text-center">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… Ø¨Ù†Ø§ âœ¨</p>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="downloadReceipt()" class="bg-blue-600 text-white p-3 rounded-xl font-bold text-sm">ğŸ’¾ Ø­ÙØ¸ ØµÙˆØ±Ø©</button>
                <button onclick="shareReceiptText()" class="bg-green-600 text-white p-3 rounded-xl font-bold text-sm">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ù†Øµ</button>
                <button onclick="closeReceipt()" class="col-span-2 text-slate-400 mt-2">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <div id="receipt-canvas-area"></div>

    <script>
        const STORAGE_KEY = "NAS_PRO_V2";
        let clients = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let selectedDays = 0;
        let selectedPaid = null;
        let selectedDate = null;
        let editIndex = null;

        const el = (id) => document.getElementById(id);

        function showTab(tab) {
            if(tab === 'add') {
                el('viewAdd').classList.remove('hidden');
                el('viewList').classList.add('hidden');
                el('tabAdd').classList.add('tab-active');
                el('tabList').classList.remove('tab-active');
            } else {
                el('viewAdd').classList.add('hidden');
                el('viewList').classList.remove('hidden');
                el('tabAdd').classList.remove('tab-active');
                el('tabList').classList.add('tab-active');
                render();
            }
        }

        function setDays(btn, val) {
            document.querySelectorAll('#daysContainer button').forEach(b => b.classList.remove('btn-active'));
            btn.classList.add('btn-active');
            selectedDays = val;
            selectedDate = null;
            el('customDate').value = "";
        }

        function setCustomDate(val) {
            document.querySelectorAll('#daysContainer button').forEach(b => b.classList.remove('btn-active'));
            selectedDate = val;
            selectedDays = 0;
        }

        function setPaid(status) {
            el('btnPaid').classList.remove('btn-active');
            el('btnUnpaid').classList.remove('btn-active');
            if(status) el('btnPaid').classList.add('btn-active');
            else el('btnUnpaid').classList.add('btn-active');
            selectedPaid = status;
        }

        function saveClient() {
            const name = el('name').value.trim();
            const phone = el('phone').value.trim();
            const service = el('service').value.trim();
            const insta = el('insta').value.trim().replace('@', '');
            const link = el('link').value.trim();
            const notes = el('notes').value.trim();

            if (!name || (selectedDays === 0 && !selectedDate) || selectedPaid === null) {
                alert("âš ï¸ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…Ø¯Ø©ØŒ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹)");
                return;
            }

            let endDate;
            if(selectedDate) {
                endDate = new Date(selectedDate);
            } else {
                endDate = new Date();
                endDate.setDate(endDate.getDate() + selectedDays);
            }

            const data = {
                name, phone, service, insta, link, notes,
                paid: selectedPaid,
                end: endDate.toISOString()
            };

            if (editIndex !== null) clients[editIndex] = data;
            else clients.unshift(data);

            localStorage.setItem(STORAGE_KEY, JSON.stringify(clients));
            clearForm();
            checkExpirations();
            alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸");
            showTab('list');
        }

        function clearForm() {
            el('name').value = el('phone').value = el('service').value = el('insta').value = el('link').value = el('notes').value = el('customDate').value = "";
            selectedDays = 0; selectedPaid = null; selectedDate = null; editIndex = null;
            document.querySelectorAll('.btn-active').forEach(b => b.classList.remove('btn-active'));
            el('mainBtn').textContent = "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø²Ø¨ÙˆÙ†";
        }

        function render() {
            const q = el('search').value.toLowerCase();
            const list = el('clientsList');
            list.innerHTML = "";
            const now = new Date();

            clients.forEach((c, i) => {
                if (c.name.toLowerCase().includes(q) || c.phone.includes(q)) {
                    const isExp = new Date(c.end) < now;
                    list.innerHTML += `
                        <div class="glass-card p-5 rounded-2xl border-r-4 ${isExp ? 'border-red-600' : 'border-green-500'}">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-bold text-lg">${c.name}</h3>
                                    <p class="text-xs text-blue-400 font-bold">${c.service}</p>
                                </div>
                                ${c.insta ? `<a href="https://instagram.com/${c.insta}" target="_blank" class="text-pink-500 text-xl">ğŸ“¸</a>` : ''}
                            </div>
                            
                            <div class="text-xs mt-3 opacity-70 space-y-1">
                                <p>ğŸ“… ÙŠÙ†ØªÙ‡ÙŠ: ${new Date(c.end).toLocaleDateString('ar-EG')}</p>
                                ${c.notes ? `<p class="italic text-yellow-500">ğŸ“ ${c.notes}</p>` : ''}
                            </div>

                            <div class="flex gap-2 mt-4">
                                <button onclick="openReceipt(${i})" class="bg-blue-600/20 text-blue-400 p-2 px-3 rounded-lg text-xs">ÙˆØµÙ„ ğŸ“„</button>
                                <button onclick="editClient(${i})" class="bg-slate-700 p-2 px-3 rounded-lg text-xs">ØªØ¹Ø¯ÙŠÙ„</button>
                                <button onclick="deleteClient(${i})" class="bg-red-900/20 text-red-400 p-2 px-3 rounded-lg text-xs">Ø­Ø°Ù</button>
                                <a href="https://wa.me/964${c.phone}" target="_blank" class="mr-auto bg-green-600 p-2 px-4 rounded-lg text-xs font-bold">ÙˆØ§ØªØ³Ø§Ø¨</a>
                            </div>
                        </div>
                    `;
                }
            });
        }

        function checkExpirations() {
            const now = new Date();
            const expired = clients.some(c => new Date(c.end) < now);
            el('expiryAlert').classList.toggle('hidden', !expired);
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØµÙ„
        let currentReceiptClient = null;
        function openReceipt(i) {
            currentReceiptClient = clients[i];
            el('rName').textContent = currentReceiptClient.name;
            el('rService').textContent = currentReceiptClient.service;
            el('rEnd').textContent = new Date(currentReceiptClient.end).toLocaleDateString('ar-EG');
            el('receiptModal').classList.remove('hidden');
        }

        function closeReceipt() { el('receiptModal').classList.add('hidden'); }

        async function downloadReceipt() {
            const area = el('printableReceipt');
            const canvas = await html2canvas(area);
            const link = document.createElement('a');
            link.download = `Receipt-${currentReceiptClient.name}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function shareReceiptText() {
            const text = `ÙˆØµÙ„ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù† NAS\nØ§Ù„Ø²Ø¨ÙˆÙ†: ${currentReceiptClient.name}\nØ§Ù„Ø®Ø¯Ù…Ø©: ${currentReceiptClient.service}\nÙŠÙ†ØªÙ‡ÙŠ Ø¨ØªØ§Ø±ÙŠØ®: ${new Date(currentReceiptClient.end).toLocaleDateString('ar-EG')}\nØ´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„Ùƒ Ù…Ø¹Ù†Ø§!`;
            if (navigator.share) {
                navigator.share({ title: 'ÙˆØµÙ„ Ø§Ø´ØªØ±Ø§Ùƒ', text: text });
            } else {
                navigator.clipboard.writeText(text);
                alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©");
            }
        }

        function editClient(i) {
            editIndex = i;
            const c = clients[i];
            el('name').value = c.name;
            el('phone').value = c.phone;
            el('service').value = c.service;
            el('insta').value = c.insta || "";
            el('link').value = c.link || "";
            el('notes').value = c.notes || "";
            setPaid(c.paid);
            el('mainBtn').textContent = "ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
            showTab('add');
        }

        function deleteClient(i) {
            if(confirm("Ø­Ø°Ù Ø§Ù„Ø²Ø¨ÙˆÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                clients.splice(i, 1);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(clients));
                render();
            }
        }

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„
        checkExpirations();
    </script>
</body>
</html>
